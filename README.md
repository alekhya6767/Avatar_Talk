# Avatar Translator

A local, fully FOSS pipeline that converts English audio to Spanish audio using optimized open-source models. **4x faster** than previous versions with lightweight model selection.

## ðŸš€ Performance Optimized

- **Processing Time**: ~20-30 seconds for 1-minute audio (vs 8+ minutes previously)
- **Whisper Tiny Model**: 3x faster ASR with good accuracy
- **Google TTS**: Fast online synthesis with direct MP3 output
- **Lightweight Dependencies**: Minimal resource usage

## Components

- **ASR**: faster-whisper with Whisper tiny model - Fast and accurate speech recognition
- **MT**: MarianMT (Helsinki-NLP opus-mt-en-es) with Argos Translate fallback - Neural machine translation  
- **TTS**: Google TTS (gTTS) - Fast online text-to-speech synthesis

## Features

- âœ… **4x speed improvement** with optimized model selection
- âœ… Modern Python packaging with `uv` and `pyproject.toml`
- âœ… Modular package structure under `src/avatar_translator/`
- âœ… Google TTS for fast Spanish audio generation
- âœ… Automatic fallback translation system
- âœ… Comprehensive error handling and logging
- âœ… Performance timing metrics
- âœ… Clean CLI interface with detailed output

## Quick Start

1. **Install with uv (recommended):**
```bash
# Install uv if not already installed
pip install uv

# Install all dependencies automatically
uv sync
```

2. **Or install manually:**
```bash
pip install -e .
```

3. **Run translation:**
```bash
# Using the CLI module
python3 -m src.avatar_translator.cli input_audio.mp3 output_spanish.mp3

# Examples with your test files
python3 -m src.avatar_translator.cli src/avatar_translator/birthdays.mp3 birthdays_spanish.mp3
python3 -m src.avatar_translator.cli src/avatar_translator/beauty.mp3 beauty_spanish.mp3
```

## Usage Examples

### Command Line Interface
```bash
# Basic usage - converts English audio to Spanish
python3 -m src.avatar_translator.cli input.mp3 output_spanish.mp3

# The pipeline will:
# 1. Transcribe English audio using Whisper tiny
# 2. Translate text to Spanish using MarianMT
# 3. Generate Spanish audio using Google TTS
```

### Python API
```python
from src.avatar_translator import AudioTranslator

# Initialize translator with optimized settings
translator = AudioTranslator(
    whisper_model_size="tiny",  # Fast processing
    log_level="INFO"
)

# Translate audio
results = translator.translate_audio(
    input_audio="english_audio.mp3",
    output_audio="spanish_audio.mp3",
    intermediate_files=True  # Save .en.txt and .es.txt files
)

print(f"Translation completed in {results['timings']['total']:.2f}s")
print(f"ASR: {results['timings']['asr']:.2f}s")
print(f"MT: {results['timings']['mt']:.2f}s") 
print(f"TTS: {results['timings']['tts']:.2f}s")
```

## Supported Audio Formats

- **Input**: MP3, WAV, M4A, FLAC, OGG (any format supported by faster-whisper)
- **Output**: MP3 (generated by Google TTS)

## Model Options

### Whisper Models (ASR)
- `tiny` - **Fastest, good accuracy** (~39 MB) **[Default - Recommended]**
- `base` - Balanced performance (~74 MB)
- `small` - Better accuracy (~244 MB)
- `medium` - High accuracy (~769 MB)
- `large-v2/large-v3` - Best accuracy (~1550 MB)

### Translation Models
- **Primary**: MarianMT (Helsinki-NLP opus-mt-en-es) - High quality neural translation
- **Fallback**: Argos Translate (automatically configured)

### TTS Engine
- **Google TTS (gTTS)**: Fast online synthesis, direct MP3 output, natural Spanish voices

## Performance Benchmarks

**1-minute English audio processing time:**

| Component | Time | Model Used |
|-----------|------|------------|
| ASR | ~5-6s | Whisper tiny |
| MT | ~6-11s | MarianMT |
| TTS | ~8-10s | Google TTS |
| **Total** | **~20-30s** | **Optimized pipeline** |

*Previous version: 8+ minutes*

## Installation Requirements

```bash
# Core dependencies (automatically installed)
uv add faster-whisper>=0.10.0
uv add transformers>=4.35.0
uv add argostranslate>=1.9.0
uv add gtts>=2.3.0
```

## Troubleshooting

### Common Issues

1. **Internet connection required**: Google TTS needs internet access
2. **Model download**: First run downloads MarianMT model (~312MB)
3. **Audio format**: Input files are automatically converted by faster-whisper

### Performance Tips

- **Fastest processing**: Use default `tiny` Whisper model
- **Better accuracy**: Switch to `base` or `small` models
- **Offline operation**: Consider switching back to Piper TTS if needed
- **GPU acceleration**: Install CUDA-compatible PyTorch for faster processing

### Logs and Debugging

Enable verbose logging:
```python
translator = AudioTranslator(log_level="DEBUG")
```

Save intermediate files for inspection:
```python
results = translator.translate_audio(..., intermediate_files=True)
# Creates: output.en.txt (English transcription) and output.es.txt (Spanish translation)
```

## Project Structure

```
Avatar_Talk/
â”œâ”€â”€ src/avatar_translator/          # Main package
â”‚   â”œâ”€â”€ __init__.py                # Package initialization
â”‚   â”œâ”€â”€ core.py                    # AudioTranslator pipeline
â”‚   â”œâ”€â”€ asr.py                     # Speech recognition module
â”‚   â”œâ”€â”€ mt.py                      # Machine translation module
â”‚   â”œâ”€â”€ tts.py                     # Text-to-speech module
â”‚   â”œâ”€â”€ cli.py                     # Command-line interface
â”‚   â”œâ”€â”€ birthdays.mp3              # Test audio file
â”‚   â””â”€â”€ beauty.mp3                 # Test audio file
â”œâ”€â”€ pyproject.toml                 # Modern Python packaging
â”œâ”€â”€ uv.lock                        # Dependency lock file
â”œâ”€â”€ README.md                      # This file
â””â”€â”€ .gitignore                     # Git ignore rules
```

## Requirements

- Python 3.8+
- 2GB+ RAM (4GB+ recommended)
- Internet connection (for Google TTS and model downloads)
- Optional: CUDA-compatible GPU for acceleration
